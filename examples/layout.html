<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>sigma.js examples | ForceAtlas 2 example</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/sigma.css" rel="stylesheet">
    <style type="text/css">
      body{
        margin: 0;
        padding: 0;
        padding-top: 60px;
      }
      div#sigma-container{
        width: 100%;
        height: 420px;
        margin-bottom: 15px;
        background-color: #EEE;
        -webkit-border-radius: 3px;
        -moz-border-radius: 3px;
        border-radius: 3px;
      }
      div#control-buttons{
        text-align: right;
      }
      a.brand{
        font-family: Lobster, "Arial Black";
      }
    </style>
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
          </a>
          <a class="brand">sigma.js</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="divider-vertical"></li>
              <li><a href="index.html">Basic example</a></li>
              <li><a href="display.html">Display</a></li>
              <li class="active"><a>Layout</a></li>
              <li><a href="http://github.com/jacomyal/sigma.js">Sources</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span6">
          <h2>Force Atlas 2 layout example</h2>
        </div>
        <div id="control-buttons" class="span6">
          <a class="btn" onclick="startLayout();">Start layout</a>
          <a class="btn" onclick="stopLayout();">Stop layout</a>
          <a class="btn" onclick="resetPosition();">Reset zoom</a>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span12">
          <div id="sigma-container"></div>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span12">
          <a href="https://gephi.org/2011/forceatlas2-the-new-version-of-our-home-brew-layout/" target="_blank">ForceAtlas 2</a> is a graph layout algorithm developed by <a href="http://www.medialab.sciences-po.fr/en/team-en/mathieu-jacomy-en/" target="_blank">Mathieu Jacomy</a>, much thanks to him for this JavaScript implementation.
        </div>
      </div>
    </div>

    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../build/sigma.concat.js"></script>
    <script type="text/javascript" src="../plugins/forceatlas2.js"></script>
    <script type="text/javascript">
      var s, f;

      function opt(name){
        name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
        var regexS = "[\\?&]"+name+"=([^&#]*)";
        var regex = new RegExp( regexS );
        var results = regex.exec(window.location.href);
        if(results == null){
          return '';
        }else{
          return results[1];
        }
      }
      
      function init(){
        if(!s){
          // INIT SIGMA:
          sigma.debugMode = 1;
          s = sigma.init(document.getElementById('sigma-container')).config_drawing({
            // Labels:
            font: '"Helvetica Neue",Helvetica,Arial,sans-serif',
            defaultLabelColor: '#000',
            defaultLabelSize: 14,
            defaultLabelBGColor: '#fff',
            defaultLabelHoverColor: '#000',
            labelThreshold: 7,
            // Edges
            defaultEdgeType: 'curve'
          });
    
          // INIT GRAPH:
          //
          // The graph is generated in different clusters
          // to make the layout efficiency easier to observe.
          var N = opt('nodes') || opt('n') || 1000;
          var E = opt('edges') || opt('e') || 5000;
          var C = opt('clusters') || opt('c') || 10;
          var d = opt('clustering') || opt('d') || 0.5;
          window.clusters = [];

          for(var i=0;i<C;i++){
            window.clusters.push({
              'id': i,
              'color': 'rgb('+Math.round(Math.random()*256)+','+
                              Math.round(Math.random()*256)+','+
                              Math.round(Math.random()*256)+')',
              'nodes': []
            });
          }

          for(var i=0;i<N;i++){
            var cluster = clusters[(Math.random()*C)|0];
            s.addNode('n'+i,{
              'x': 1000*Math.random(),
              'y': 1000*Math.random(),
              'label': 'Node number '+i,
              'size': 1+3*Math.random(),
              'color': cluster['color'],
              'cluster': cluster['id']
            });
            cluster.nodes.push('n'+i);
          }

          for(var i=0;i<E;i++){
            if(Math.random()<1-d){
              s.addEdge('e'+i,'n'+(Math.random()*N|0),'n'+(Math.random()*N|0),{
                'size': 1.6
              });
            }else{
              var cluster = clusters[(Math.random()*C)|0], n = cluster.nodes.length;
              s.addEdge('e'+i,cluster.nodes[Math.random()*n|0],cluster.nodes[Math.random()*n|0],{
                'size': 1.6
              });
            }
          }

          s.activateMonitoring();

          s.bind('overnodes outnodes downnodes upnodes',function(e){
            console.log(e.type, e.content.map(function(n){
              return n.id;
            }).join(', '));
          });

          // Here is the code to initialize properly FA2:
          f = new forceatlas2.ForceAtlas2(s.getGraph());
          f.setAutoSettings();
          f.init();

          window.onresize = function(){
            s.resize();
          };
        }

        s.draw();
      }

      function resetPosition(){
        if(!s){
          return;
        }
        s.position(0,0,1);

        s.draw(
          s.config('lastNodes'),
          s.config('lastEdges'),
          s.config('lastLabels'),
          true
        );
      }

      function startLayout(){
        if(s && f){
          s.addGenerator('fa', f.atomicGo, function(){
            return true;
          });
        }
      }

      function stopLayout(){
        if(s && f){
          s.removeGenerator('fa');
        }
      }

      $(document).ready(function(){
        init();
        startLayout();
      });
    </script>

  </body>
</html>
